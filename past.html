<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShallWe!? — Past events</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script type="module" src="firebase.js?v=7"></script>
</head>
<body>
  <header class="header">
    <div class="container header-inner">
      <a class="logo" href="index.html" aria-label="Home"><svg viewBox="0 0 24 24"><path d="M8 19l2-6 2 2v5h2v-6l2-2 3 2v-3l-3-2-4 1-2-3-2 1 1 3-3 8h2z"/></svg></a>
      <div class="appname center">ShallWe!? — Past events</div>
      <a class="menu-btn" href="index.html" aria-label="Back">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
      </a>
    </div>
  </header>

  <main class="container">
    <section class="card" id="list">
      <h2 class="subtitle">Archive</h2>
      <div id="events"></div>
    </section>
  </main>

  <script type="module">
    import { listPastEvents } from './firebase.js?v=7';

    const container = document.getElementById('events');

    function formatUK(dateIso){
      if(!dateIso) return '—';
      const [y,m,d] = dateIso.split('-').map(Number);
      return new Date(y,m-1,d).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'});
    }

    function chip(name, status){
      const s = (status||'maybe').toLowerCase();
      const div = document.createElement('div');
      div.className = 'pill ' + (s==='going' ? 'going' : s==='not_going' ? 'not' : 'maybe');
      div.innerHTML = `<span class="dot"></span><span>${name||'Unnamed'}</span>`;
      return div;
    }

    (async function load(){
      const items = await listPastEvents();
      container.innerHTML = '';
      if(items.length===0){
        container.innerHTML = '<p class="muted">No past events archived yet.</p>';
        return;
      }
      items.forEach(ev=>{
        const card = document.createElement('div');
        card.className = 'item';

        const title = document.createElement('h3');
        title.textContent = ev.title || 'Untitled';
        card.appendChild(title);

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = `${formatUK(ev.date)} • ${ev.time || '—'} • ${ev.location || ev.place || '—'}`;
        card.appendChild(meta);

        if (ev.description){
          const p = document.createElement('p');
          p.textContent = ev.description;
          card.appendChild(p);
        }

        const legend = document.createElement('div');
        legend.className = 'legend';
        const parts = Array.isArray(ev.participants) ? ev.participants : [];
        const going = parts.filter(p => (p.status||'maybe').toLowerCase() === 'going').length;
        const maybe = parts.filter(p => (p.status||'maybe').toLowerCase() === 'maybe').length;
        const notgo = parts.filter(p => (p.status||'maybe').toLowerCase() === 'not_going').length;
        legend.innerHTML = `
          <div class="item"><span class="sw going"></span> Going (${going})</div>
          <div class="item"><span class="sw maybe"></span> Maybe (${maybe})</div>
          <div class="item"><span class="sw not"></span> Not going (${notgo})</div>
        `;
        card.appendChild(legend);

        const wrap = document.createElement('div');
        wrap.className = 'pillwrap';
        parts.forEach(p => wrap.appendChild(chip(p.name, p.status)));
        card.appendChild(wrap);

        container.appendChild(card);
      });
    })();
  </script>
</body>
</html>
